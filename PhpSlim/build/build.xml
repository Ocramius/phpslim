<?xml version="1.0" encoding="UTF-8"?>
<project name="PhpSlim" default="build" basedir="..">
    <property name="log" location="build/log"/>

    <target name="build" depends="test,makePear">
    </target>

    <target name="makePear">
        <mkdir dir="build/PEAR"/>
        <delete includeemptydirs="true">
            <fileset dir="build/PEAR" includes="**/*"/>
        </delete>
        <exec executable="php" dir="build" failonerror="true">
            <arg line="package.php make" />
        </exec>
        <exec executable="pear" dir="" failonerror="true">
            <arg line="package package.xml" />
        </exec>
        <move todir="build/PEAR">
            <fileset dir=".">
                <include name="package.xml"/>
                <include name="PhpSlim*.tgz"/>
            </fileset>
        </move>
    </target>

    <target name="test" depends="phpunit,phplint,phpcs,stricttests">
    </target>

    <target name="phpcs">
        <exec executable="phpcs" dir="" output="${log}/checkstyle.xml" failonerror="true">
            <arg line="--report=checkstyle --standard=ZEND PhpSlim TestModule Examples"/>
        </exec>
    </target>
    <target name="phpunit">
        <exec executable="phpunit" dir="" failonerror="true">
            <arg line="--log-xml ${log}/PhpSlim_phpunit.xml
                PhpSlim_Tests_AllTests PhpSlim/Tests/AllTests.php" />
        </exec>
    </target>
    <target name="stricttests">
        <exec executable="php" dir="" failonerror="true">
            <arg line="runtests.php" />
        </exec>
    </target>

    <target name="phplint">
        <apply executable="php" failonerror="true">
            <arg value="-l" />
            <fileset dir="">
                <include name="**/*.php" />
            </fileset>
        </apply>
    </target>


    <target name="zipAll">
        <zip destfile="${log}/PhpSlimAll.zip"
            basedir="."
            excludes="build/log/**"
        />
    </target>
</project>
